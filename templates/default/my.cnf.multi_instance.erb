# generated by Chef for node <%= node["fqdn"] %>

<%# TODO: render with partials %>

[mysqld_safe]
nice             = <%= node["percona"]["server"]["nice"] %>
open-files-limit = <%= node["percona"]["server"]["open_files_limit"] %>

[mysqld]
user              = <%= node["percona"]["server"]["username"] %>
basedir           = <%= node["percona"]["server"]["basedir"] %>
tmpdir            = <%= node["percona"]["server"]["tmpdir"] %>
character_set_server = <%= node["percona"]["server"]["character_set"] %>
collation_server  = <%= node["percona"]["server"]["collation"] %>

<% if node["percona"]["server"]["skip_name_resolve"] %>
skip-name-resolve
<% end %>

<% if node["percona"]["server"]["skip_external_locking"] %>
skip-external-locking
<% end %>

net_read_timeout = <%= node["percona"]["server"]["net_read_timeout"] %>
connect_timeout  = <%= node["percona"]["server"]["connect_timeout"] %>

# Instead of skip-networking the default is now to listen only on
# localhost which is more compatible and is not less secure.
<% if !node["percona"]["server"]["bind_address"].empty? %>
bind-address = <%= node["percona"]["server"]["bind_address"] %>
<% end %>

#
# * Fine Tuning
#
key_buffer = <%= node["percona"]["server"]["key_buffer"] %>

# The maximum size of a query packet the server can handle as well as
# maximum query size server can process (Important when working with
# large BLOBs).  enlarged dynamically, for each connection.
max_allowed_packet  = <%= node["percona"]["server"]["max_allowed_packet"] %>

# Maximum String length size of a group concat result
group_concat_max_len = <%= node["percona"]["server"]["group_concat_max_len"] %>

# Thread stack size to use. This amount of memory is always reserved at
# connection time. MySQL itself usually needs no more than 64K of
# memory, while if you use your own stack hungry UDF functions or your
# OS requires more stack for some operations, you might need to set this
# to a higher value.
thread_stack = <%= node["percona"]["server"]["thread_stack"] %>

thread_cache_size = <%= node["percona"]["server"]["thread_cache_size"] %>

# This replaces the startup script and checks MyISAM tables if needed
# the first time they are touched
myisam-recover = <%= node["percona"]["server"]["myisam_recover"] %>
#max_connections        = 100
#table_cache            = 64
#thread_concurrency     = 10
#
# * Query Cache Configuration
#
query_cache_limit = <%= node["percona"]["server"]["query_cache_limit"] %>
query_cache_size  = <%= node["percona"]["server"]["query_cache_size"] %>

[mysqld_multi]
mysqld     = mysqld
mysqladmin = mysqladmin

<% @instance_ports.each do |port| %>
[mysqld<%= port %>]
port     = <%= port %>
socket   = <%= node["percona"]["server"]["socket"] % { :port => port } %>
datadir  = <%= node["percona"]["server"]["datadir"] % { :port => port } %>
pid-file = <%= node["percona"]["server"]["pidfile"] % { :port => port } %>
<% end %>
